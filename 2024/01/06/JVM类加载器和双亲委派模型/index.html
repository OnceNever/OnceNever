

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="https://image.seeyourface.cn/migrate/pixel.png">
  <link rel="icon" href="https://image.seeyourface.cn/migrate/pixel.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Yang Lei">
  <meta name="keywords" content="">
  
    <meta name="description" content="åºè¨€åœ¨äº†è§£ç±»åŠ è½½å™¨ä¹‹å‰é¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“åœ¨JVMä¸­ç±»åŠ è½½çš„è¿‡ç¨‹æ­¥éª¤ä¸ºï¼šåŠ è½½ -&gt; è¿æ¥ -&gt; åˆå§‹åŒ–ã€‚ è€Œè¿æ¥è¿‡ç¨‹åˆå¯ä»¥è¿›ä¸€æ­¥ç»†åˆ†ä¸ºä¸‰æ­¥ï¼šéªŒè¯ -&gt;  å‡†å¤‡ -&gt; è§£æã€‚  åŠ è½½æ˜¯ç±»åŠ è½½è¿‡ç¨‹çš„ç¬¬ä¸€æ­¥ï¼Œä¸»è¦å®Œæˆä¸‹é¢ 3 ä»¶äº‹æƒ…ï¼š  é€šè¿‡å…¨ç±»åè·å–å®šä¹‰æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ å°†å­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„è½¬æ¢ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ åœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¯¥ç±»çš„ Class å¯¹è±¡ï¼Œä½œä¸ºæ–¹">
<meta property="og:type" content="article">
<meta property="og:title" content="JVMç±»åŠ è½½å™¨å’ŒåŒäº²å§”æ´¾æ¨¡å‹">
<meta property="og:url" content="https://seeyourface.cn/2024/01/06/JVM%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8%E5%92%8C%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE%E6%A8%A1%E5%9E%8B/index.html">
<meta property="og:site_name" content="Keinmal">
<meta property="og:description" content="åºè¨€åœ¨äº†è§£ç±»åŠ è½½å™¨ä¹‹å‰é¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“åœ¨JVMä¸­ç±»åŠ è½½çš„è¿‡ç¨‹æ­¥éª¤ä¸ºï¼šåŠ è½½ -&gt; è¿æ¥ -&gt; åˆå§‹åŒ–ã€‚ è€Œè¿æ¥è¿‡ç¨‹åˆå¯ä»¥è¿›ä¸€æ­¥ç»†åˆ†ä¸ºä¸‰æ­¥ï¼šéªŒè¯ -&gt;  å‡†å¤‡ -&gt; è§£æã€‚  åŠ è½½æ˜¯ç±»åŠ è½½è¿‡ç¨‹çš„ç¬¬ä¸€æ­¥ï¼Œä¸»è¦å®Œæˆä¸‹é¢ 3 ä»¶äº‹æƒ…ï¼š  é€šè¿‡å…¨ç±»åè·å–å®šä¹‰æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ å°†å­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„è½¬æ¢ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ åœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¯¥ç±»çš„ Class å¯¹è±¡ï¼Œä½œä¸ºæ–¹">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://image.seeyourface.cn/2024/01/e756e4b0cdae0889ccd514ce59cfefac.png">
<meta property="og:image" content="https://image.seeyourface.cn/2024/01/0c2e2eb7811f32d0b10a98c93f34e390.png">
<meta property="og:image" content="https://image.seeyourface.cn/2024/01/0c2e2eb7811f32d0b10a98c93f34e390.png">
<meta property="og:image" content="https://image.seeyourface.cn/2024/01/6c83c58cc5b97edca3ef2db2abe6ae7b.png">
<meta property="article:published_time" content="2024-01-06T05:00:18.000Z">
<meta property="article:modified_time" content="2024-03-06T02:32:20.577Z">
<meta property="article:author" content="Yang Lei">
<meta property="article:tag" content="JVM">
<meta property="article:tag" content="ç±»åŠ è½½å™¨">
<meta property="article:tag" content="åŒäº²å§”æ´¾">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://image.seeyourface.cn/2024/01/e756e4b0cdae0889ccd514ce59cfefac.png">
  
  
  
  <title>JVMç±»åŠ è½½å™¨å’ŒåŒäº²å§”æ´¾æ¨¡å‹ - Keinmal</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"seeyourface.cn","root":"/","version":"1.9.5-a","typing":{"enable":true,"typeSpeed":100,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>æ‡’å¤§ç‹</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>é¦–é¡µ</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>å½’æ¡£</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>åˆ†ç±»</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>æ ‡ç­¾</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>å…³äº</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://image.seeyourface.cn/migrate/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="JVMç±»åŠ è½½å™¨å’ŒåŒäº²å§”æ´¾æ¨¡å‹"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-01-06 13:00" pubdate>
          2024å¹´1æœˆ6æ—¥ ä¸‹åˆ
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          11k å­—
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          55 åˆ†é’Ÿ
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">JVMç±»åŠ è½½å™¨å’ŒåŒäº²å§”æ´¾æ¨¡å‹</h1>
            
            
              <div class="markdown-body">
                
                <h3 id="åºè¨€"><a href="#åºè¨€" class="headerlink" title="åºè¨€"></a>åºè¨€</h3><p>åœ¨äº†è§£ç±»åŠ è½½å™¨ä¹‹å‰é¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“åœ¨<code>JVM</code>ä¸­ç±»åŠ è½½çš„è¿‡ç¨‹æ­¥éª¤ä¸ºï¼š<strong>åŠ è½½ -&gt; è¿æ¥ -&gt; åˆå§‹åŒ–</strong>ã€‚</p>
<p>è€Œè¿æ¥è¿‡ç¨‹åˆå¯ä»¥è¿›ä¸€æ­¥ç»†åˆ†ä¸ºä¸‰æ­¥ï¼š<strong>éªŒè¯ -&gt;  å‡†å¤‡ -&gt; è§£æ</strong>ã€‚</p>
<p><img src="https://image.seeyourface.cn/2024/01/e756e4b0cdae0889ccd514ce59cfefac.png" srcset="/img/loading.gif" lazyload alt="JVMç±»åŠ è½½è¿‡ç¨‹"></p>
<p><strong>åŠ è½½</strong>æ˜¯ç±»åŠ è½½è¿‡ç¨‹çš„ç¬¬ä¸€æ­¥ï¼Œä¸»è¦å®Œæˆä¸‹é¢ 3 ä»¶äº‹æƒ…ï¼š</p>
<ol>
<li>é€šè¿‡å…¨ç±»åè·å–å®šä¹‰æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ</li>
<li>å°†å­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„è½¬æ¢ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„</li>
<li>åœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¯¥ç±»çš„ <code>Class</code> å¯¹è±¡ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™äº›æ•°æ®çš„è®¿é—®å…¥å£</li>
</ol>
<h3 id="ç±»åŠ è½½å™¨"><a href="#ç±»åŠ è½½å™¨" class="headerlink" title="ç±»åŠ è½½å™¨"></a>ç±»åŠ è½½å™¨</h3><h4 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h4><p>æ ¹æ®å®˜æ–¹æ–‡æ¡£å¯¹ç±»åŠ è½½å™¨çš„ä»‹ç»ï¼š</p>
<blockquote>
<p>A class loader is an object that is responsible for loading classes. The class ClassLoader is an abstract class. Given the binary name of a class, a class loader should attempt to locate or generate data that constitutes a definition for the class. A typical strategy is to transform the name into a file name and then read a â€œclass fileâ€ of that name from a file system.</p>
<p>Every Class object contains a reference to the ClassLoader that defined it.</p>
<p>Class objects for array classes are not created by class loaders, but are created automatically as required by the Java runtime. The class loader for an array class, as returned by Class.getClassLoader() is the same as the class loader for its element type; if the element type is a primitive type, then the array class has no class loader.</p>
</blockquote>
<p>æ„æ€æ˜¯ï¼š</p>
<blockquote>
<p>ç±»åŠ è½½å™¨æ˜¯ä¸€ä¸ªè´Ÿè´£åŠ è½½ç±»çš„å¯¹è±¡ã€‚<code>ClassLoader</code> æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ã€‚ç»™å®šç±»çš„äºŒè¿›åˆ¶åç§°ï¼Œç±»åŠ è½½å™¨åº”å°è¯•å®šä½æˆ–ç”Ÿæˆæ„æˆç±»å®šä¹‰çš„æ•°æ®ã€‚å…¸å‹çš„ç­–ç•¥æ˜¯å°†åç§°è½¬æ¢ä¸ºæ–‡ä»¶åï¼Œç„¶åä»æ–‡ä»¶ç³»ç»Ÿä¸­è¯»å–è¯¥åç§°çš„â€œç±»æ–‡ä»¶â€ã€‚</p>
<p>æ¯ä¸ª Java ç±»éƒ½æœ‰ä¸€ä¸ªå¼•ç”¨æŒ‡å‘åŠ è½½å®ƒçš„ <code>ClassLoader</code>ã€‚ä¸è¿‡ï¼Œ<strong>æ•°ç»„ç±»ä¸æ˜¯é€šè¿‡ <code>ClassLoader</code> åˆ›å»ºçš„</strong>ï¼Œè€Œæ˜¯ JVM åœ¨éœ€è¦çš„æ—¶å€™è‡ªåŠ¨åˆ›å»ºçš„ï¼Œæ•°ç»„ç±»é€šè¿‡<code>getClassLoader()</code>æ–¹æ³•è·å– <code>ClassLoader</code> çš„æ—¶å€™å’Œè¯¥æ•°ç»„çš„å…ƒç´ ç±»å‹çš„ <code>ClassLoader</code> æ˜¯ä¸€è‡´çš„ã€‚</p>
</blockquote>
<p>ä»ä¸Šé¢çš„ä»‹ç»å¯ä»¥çŸ¥é“:</p>
<ul>
<li><p>ç±»åŠ è½½å™¨æ˜¯ä¸€ä¸ªè´Ÿè´£åŠ è½½ç±»çš„å¯¹è±¡ï¼Œç”¨äºå®ç°ç±»åŠ è½½è¿‡ç¨‹ä¸­çš„åŠ è½½è¿™ä¸€æ­¥ã€‚</p>
</li>
<li><p>æ¯ä¸ª Java ç±»éƒ½æœ‰ä¸€ä¸ªå¼•ç”¨æŒ‡å‘åŠ è½½å®ƒçš„ <code>ClassLoader</code>ã€‚</p>
</li>
<li><p>æ•°ç»„ç±»ä¸æ˜¯é€šè¿‡ <code>ClassLoader</code> åˆ›å»ºçš„ï¼ˆæ•°ç»„ç±»æ²¡æœ‰å¯¹åº”çš„äºŒè¿›åˆ¶å­—èŠ‚æµï¼‰ï¼Œæ˜¯ç”± JVM ç›´æ¥ç”Ÿæˆçš„ã€‚</p>
</li>
</ul>
<p>æ€»è€Œè¨€ä¹‹ï¼Œ<strong>ç±»åŠ è½½å™¨çš„ä¸»è¦ä½œç”¨å°±æ˜¯åŠ è½½ Java ç±»çš„å­—èŠ‚ç ï¼ˆ <code>.class</code> æ–‡ä»¶ï¼‰åˆ° JVM ä¸­ï¼ˆåœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¯¥ç±»çš„ <code>Class</code> å¯¹è±¡ï¼‰ã€‚</strong> å­—èŠ‚ç å¯ä»¥æ˜¯ Java æºç¨‹åºï¼ˆ<code>.java</code>æ–‡ä»¶ï¼‰ç»è¿‡ <code>javac</code> ç¼–è¯‘å¾—æ¥ï¼Œä¹Ÿå¯ä»¥æ˜¯é€šè¿‡å·¥å…·åŠ¨æ€ç”Ÿæˆæˆ–è€…é€šè¿‡ç½‘ç»œä¸‹è½½å¾—æ¥ã€‚</p>
<h4 id="åŠ è½½è§„åˆ™"><a href="#åŠ è½½è§„åˆ™" class="headerlink" title="åŠ è½½è§„åˆ™"></a>åŠ è½½è§„åˆ™</h4><p><code>JVM</code>å¯åŠ¨çš„æ—¶å€™ï¼Œå¹¶ä¸ä¼šä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰çš„ç±»ï¼Œè€Œæ˜¯æ ¹æ®éœ€è¦å»åŠ¨æ€åŠ è½½ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¤§éƒ¨åˆ†ç±»åœ¨å…·ä½“ç”¨åˆ°çš„æ—¶å€™æ‰ä¼šå»åŠ è½½ï¼Œè¿™æ ·å¯¹å†…å­˜æ›´åŠ å‹å¥½ã€‚</p>
<p>å¯¹äºå·²ç»åŠ è½½çš„ç±»ä¼šè¢«æ”¾åœ¨ <code>ClassLoader</code> ä¸­ã€‚åœ¨ç±»åŠ è½½çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šé¦–å…ˆåˆ¤æ–­å½“å‰ç±»æ˜¯å¦è¢«åŠ è½½è¿‡ã€‚å·²ç»è¢«åŠ è½½çš„ç±»ä¼šç›´æ¥è¿”å›ï¼Œå¦åˆ™æ‰ä¼šå°è¯•åŠ è½½ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äº<strong>åŒä¸€ä¸ªç±»åŠ è½½å™¨æ¥è¯´</strong>ï¼Œç›¸åŒäºŒè¿›åˆ¶åç§°çš„ç±»åªä¼šè¢«åŠ è½½ä¸€æ¬¡ã€‚</p>
<p>åœ¨<code>JVM</code>ä¸­ï¼Œä¸€ä¸ªç±»çš„å”¯ä¸€æ€§æ˜¯éœ€è¦è¿™ä¸ªç±»æœ¬èº«å’Œç±»åŠ è½½ä¸€èµ·æ‰èƒ½ç¡®å®šçš„ï¼Œæ¯ä¸ªç±»åŠ è½½å™¨éƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„å‘½åç©ºé—´ã€‚</p>
<p>ä¸åŒçš„ç±»åŠ è½½å™¨ï¼Œå³ä½¿æ˜¯åŒä¸€ä¸ªç±»å­—èŠ‚ç æ–‡ä»¶ï¼Œæœ€ååœ¨<code>JVM</code>é‡Œçš„ç±»å¯¹è±¡ä¹Ÿä¸æ˜¯åŒä¸€ä¸ªï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢è¿™æ®µä»£ç æ¥éªŒè¯è¿™ä¸ªç»“è®ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ClassLoaderTest</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ClassNotFoundException, IllegalAccessException,<br>            InstantiationException &#123;<br><br>        <span class="hljs-comment">// è‡ªå®šä¹‰ClassLoader</span><br>        <span class="hljs-type">ClassLoader</span> <span class="hljs-variable">myLoader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassLoader</span>() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> Class&lt;?&gt; loadClass(String name) <span class="hljs-keyword">throws</span> ClassNotFoundException &#123;<br>                <span class="hljs-type">String</span> <span class="hljs-variable">fileName</span> <span class="hljs-operator">=</span> name.substring(name.lastIndexOf(<span class="hljs-string">&quot;.&quot;</span>) + <span class="hljs-number">1</span>) + <span class="hljs-string">&quot;.class&quot;</span>;<br>                <span class="hljs-type">InputStream</span> <span class="hljs-variable">inputStream</span> <span class="hljs-operator">=</span> getClass().getResourceAsStream(fileName);<br>                <span class="hljs-keyword">if</span> (inputStream == <span class="hljs-literal">null</span>) &#123;<br>                    <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.loadClass(name);<br>                &#125;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    <span class="hljs-type">byte</span>[] b = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[inputStream.available()];<br>                    inputStream.read(b);<br>                    <span class="hljs-keyword">return</span> defineClass(name, b, <span class="hljs-number">0</span>, b.length);<br>                &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassNotFoundException</span>();<br>                &#125;<br>            &#125;<br>        &#125;;<br><br>        <span class="hljs-comment">// è‡ªå®šä¹‰ç±»åŠ è½½å™¨åŠ è½½</span><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">myClassLoaderTest</span> <span class="hljs-operator">=</span> myLoader.loadClass(<span class="hljs-string">&quot;cn.seeyourface.ClassLoaderTest&quot;</span>).newInstance();<br>        System.out.println(myClassLoaderTest.getClass());<br>        System.out.println(myClassLoaderTest <span class="hljs-keyword">instanceof</span> cn.seeyourface.ClassLoaderTest);<br><br>        <span class="hljs-type">ClassLoaderTest</span> <span class="hljs-variable">classLoaderTest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassLoaderTest</span>();<br>        System.out.println(classLoaderTest.getClass());<br>        System.out.println(classLoaderTest <span class="hljs-keyword">instanceof</span> cn.seeyourface.ClassLoaderTest);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">cn</span>.seeyourface.ClassLoaderTest<br><span class="hljs-literal">false</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">cn</span>.seeyourface.ClassLoaderTest<br><span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹å‡ºï¼Œä»£ç ä¸­ä½¿ç”¨è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼ˆ<code>myLoader</code>ï¼‰åŠ è½½çš„ç±»å’Œé€šè¿‡åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨åŠ è½½çš„ç±»ä¸æ˜¯åŒä¸€ä¸ªç±»ã€‚ç»¼ä¸Šï¼Œç±»åŠ è½½å™¨åœ¨<code>JVM</code>ä¸­çš„ä½œç”¨æœ‰ï¼š</p>
<ol>
<li>å°†ç±»çš„å­—èŠ‚ç æ–‡ä»¶ä»<code>JVM</code>å¤–éƒ¨åŠ è½½åˆ°å†…å­˜ä¸­</li>
<li>ç¡®å®šä¸€ä¸ªç±»çš„å”¯ä¸€æ€§</li>
<li>æä¾›éš”ç¦»ç‰¹æ€§ï¼Œä¸ºä¸­é—´ä»¶å¼€å‘è€…æä¾›ä¾¿åˆ©ï¼Œä¾‹å¦‚<code>Tomcat</code></li>
</ol>
<h4 id="ç±»åŠ è½½å™¨æ€»ç»“"><a href="#ç±»åŠ è½½å™¨æ€»ç»“" class="headerlink" title="ç±»åŠ è½½å™¨æ€»ç»“"></a>ç±»åŠ è½½å™¨æ€»ç»“</h4><p>JVM ä¸­å†…ç½®äº†ä¸‰ä¸ªé‡è¦çš„ <code>ClassLoader</code>ï¼š</p>
<ul>
<li><p>**<code>BootstrapClassLoader</code>(å¯åŠ¨ç±»åŠ è½½å™¨)**ï¼šæœ€é¡¶å±‚çš„åŠ è½½ç±»ï¼Œç”± C++å®ç°ï¼Œé€šå¸¸è¡¨ç¤ºä¸º <code>null</code>ï¼Œå¹¶ä¸”æ²¡æœ‰çˆ¶çº§ï¼Œä¸»è¦ç”¨æ¥åŠ è½½ <code>JDK</code> å†…éƒ¨çš„æ ¸å¿ƒç±»åº“ï¼ˆ <code>%JAVA_HOME%/lib</code>ç›®å½•ä¸‹çš„ <code>rt.jar</code>ã€<code>resources.jar</code>ã€<code>charsets.jar</code>ç­‰ jar åŒ…å’Œç±»ï¼‰ä»¥åŠè¢« <code>-Xbootclasspath</code>å‚æ•°æŒ‡å®šçš„è·¯å¾„ä¸‹çš„æ‰€æœ‰ç±»ã€‚</p>
</li>
<li><p>**<code>ExtensionClassLoader</code>(æ‰©å±•ç±»åŠ è½½å™¨)**ï¼šä¸»è¦è´Ÿè´£åŠ è½½ <code>%JRE_HOME%/lib/ext</code> ç›®å½•ä¸‹çš„ jar åŒ…å’Œç±»ä»¥åŠè¢« <code>java.ext.dirs</code> ç³»ç»Ÿå˜é‡æ‰€æŒ‡å®šçš„è·¯å¾„ä¸‹çš„æ‰€æœ‰ç±»ã€‚</p>
</li>
<li><p>**<code>AppClassLoader</code>(åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨)**ï¼šé¢å‘æˆ‘ä»¬ç”¨æˆ·çš„åŠ è½½å™¨ï¼Œè´Ÿè´£åŠ è½½å½“å‰åº”ç”¨ç±»è·¯å¾„ <code>classpath</code> ä¸‹çš„æ‰€æœ‰ <code>jar</code> åŒ…å’Œç±»ã€‚</p>
</li>
</ul>
<blockquote>
<p>**<code>rt.jar</code>**ï¼šrt ä»£è¡¨<code>â€œRunTimeâ€</code>ï¼Œ<code>rt.jar</code>æ˜¯ <code>Java</code> åŸºç¡€ç±»åº“ï¼ŒåŒ…å« <code>Java doc</code> é‡Œé¢çœ‹åˆ°çš„æ‰€æœ‰çš„ç±»çš„ç±»æ–‡ä»¶ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¸¸ç”¨å†…ç½®åº“ <code>java.xxx.*</code>éƒ½åœ¨é‡Œé¢ï¼Œæ¯”å¦‚<code>java.util.*</code>ã€<code>java.io.*</code>ã€<code>java.nio.*</code>ã€<code>java.lang.*</code>ã€<code>java.sql.*</code>ã€<code>java.math.*</code>ã€‚</p>
<p>Java 9 å¼•å…¥äº†æ¨¡å—ç³»ç»Ÿï¼Œå¹¶ä¸”ç•¥å¾®æ›´æ”¹äº†ä¸Šè¿°çš„ç±»åŠ è½½å™¨ã€‚æ‰©å±•ç±»åŠ è½½å™¨è¢«æ”¹åä¸ºå¹³å°ç±»åŠ è½½å™¨ï¼ˆplatform class loaderï¼‰ã€‚Java SE ä¸­é™¤äº†å°‘æ•°å‡ ä¸ªå…³é”®æ¨¡å—ï¼Œæ¯”å¦‚è¯´ <code>java.base</code> æ˜¯ç”±å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½ä¹‹å¤–ï¼Œå…¶ä»–çš„æ¨¡å—å‡ç”±å¹³å°ç±»åŠ è½½å™¨æ‰€åŠ è½½ã€‚</p>
</blockquote>
<p><img src="https://image.seeyourface.cn/2024/01/0c2e2eb7811f32d0b10a98c93f34e390.png" srcset="/img/loading.gif" lazyload alt="ç±»åŠ è½½å™¨å±‚æ¬¡ç»“æ„"></p>
<p>é™¤äº† <code>BootstrapClassLoader</code> æ˜¯ JVM è‡ªèº«çš„ä¸€éƒ¨åˆ†ä¹‹å¤–ï¼Œå…¶ä»–æ‰€æœ‰çš„ç±»åŠ è½½å™¨éƒ½æ˜¯åœ¨ JVM å¤–éƒ¨å®ç°çš„ï¼Œå¹¶ä¸”å…¨éƒ½ç»§æ‰¿è‡ª <code>ClassLoader</code>æŠ½è±¡ç±»ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Œä»¥ä¾¿è®©åº”ç”¨ç¨‹åºè‡ªå·±å†³å®šå¦‚ä½•å»è·å–æ‰€éœ€çš„ç±»ã€‚</p>
<p>æ¯ä¸ª <code>ClassLoader</code> å¯ä»¥é€šè¿‡<code>getParent()</code>è·å–å…¶çˆ¶ <code>ClassLoader</code>ï¼Œå¦‚æœè·å–åˆ° <code>ClassLoader</code> ä¸º<code>null</code>çš„è¯ï¼Œé‚£ä¹ˆè¯¥ç±»æ˜¯é€šè¿‡ <code>BootstrapClassLoader</code> åŠ è½½çš„ã€‚è¿™æ˜¯å› ä¸º<code>BootstrapClassLoader</code> ç”± C++ å®ç°ï¼Œç”±äºè¿™ä¸ª C++ å®ç°çš„ç±»åŠ è½½å™¨åœ¨ Java ä¸­æ˜¯æ²¡æœ‰ä¸ä¹‹å¯¹åº”çš„ç±»çš„ï¼Œæ‰€ä»¥æ‹¿åˆ°çš„ç»“æœæ˜¯ nullã€‚</p>
<p>é€šè¿‡ä¸‹é¢ä¾‹å­æ¥æ‰“å°ç±»åŠ è½½å™¨:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ClassLoaderTest</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">ClassLoader</span> <span class="hljs-variable">classLoader</span> <span class="hljs-operator">=</span> ClassLoaderTest.class.getClassLoader();<br><br>        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">tab</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>(<span class="hljs-string">&quot;|--&quot;</span>);<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">needContinue</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;<br>        <span class="hljs-keyword">while</span> (needContinue)&#123;<br>            System.out.println(tab.toString() + classLoader);<br>            <span class="hljs-keyword">if</span>(classLoader == <span class="hljs-literal">null</span>)&#123;<br>                needContinue = <span class="hljs-literal">false</span>;<br>            &#125;<span class="hljs-keyword">else</span>&#123;<br>                classLoader = classLoader.getParent();<br>                tab.append(<span class="hljs-string">&quot;--&quot;</span>);<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>æ‰“å°å†…å®¹:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">|--sun.misc.Launcher$AppClassLoader@18b4aac2<br>|----sun.misc.Launcher$ExtClassLoader@511d50c0<br>|------<span class="hljs-literal">null</span><br></code></pre></td></tr></table></figure>

<p>ä»è¾“å‡ºç»“æœå¯ä»¥çœ‹å‡ºï¼š</p>
<ul>
<li>æˆ‘ä»¬ç¼–å†™çš„ Java ç±» <code>ClassLoaderTest</code> çš„ <code>ClassLoader</code> æ˜¯<code>AppClassLoader</code>ï¼›</li>
<li><code>AppClassLoader</code>çš„çˆ¶ <code>ClassLoader</code> æ˜¯<code>ExtClassLoader</code>ï¼›</li>
<li><code>ExtClassLoader</code>çš„çˆ¶<code>ClassLoader</code>æ˜¯<code>Bootstrap ClassLoader</code>ï¼Œå› æ­¤è¾“å‡ºç»“æœä¸º nullã€‚</li>
</ul>
<h4 id="è‡ªå®šä¹‰ç±»åŠ è½½å™¨"><a href="#è‡ªå®šä¹‰ç±»åŠ è½½å™¨" class="headerlink" title="è‡ªå®šä¹‰ç±»åŠ è½½å™¨"></a>è‡ªå®šä¹‰ç±»åŠ è½½å™¨</h4><p>é™¤äº† <code>BootstrapClassLoader</code> å…¶ä»–ç±»åŠ è½½å™¨å‡ç”± Java å®ç°ä¸”å…¨éƒ¨ç»§æ‰¿è‡ª<code>java.lang.ClassLoader</code>ã€‚å¦‚æœæˆ‘ä»¬è¦è‡ªå®šä¹‰è‡ªå·±çš„ç±»åŠ è½½å™¨ï¼Œä¹Ÿéœ€è¦ç»§æ‰¿ <code>ClassLoader</code>æŠ½è±¡ç±»ã€‚</p>
<p><code>ClassLoader</code> ç±»æœ‰ä¸¤ä¸ªå…³é”®çš„æ–¹æ³•ï¼š</p>
<ul>
<li><code>protected Class loadClass(String name, boolean resolve)</code>ï¼šåŠ è½½æŒ‡å®šäºŒè¿›åˆ¶åç§°çš„ç±»ï¼Œå®ç°äº†åŒäº²å§”æ´¾æœºåˆ¶ ã€‚<code>name</code> ä¸ºç±»çš„äºŒè¿›åˆ¶åç§°ï¼Œ<code>resolve</code> å¦‚æœä¸º trueï¼Œåœ¨åŠ è½½æ—¶è°ƒç”¨ <code>resolveClass(Class&lt;?&gt; c)</code> æ–¹æ³•è§£æè¯¥ç±»ã€‚</li>
<li><code>protected Class findClass(String name)</code>ï¼šæ ¹æ®ç±»çš„äºŒè¿›åˆ¶åç§°æ¥æŸ¥æ‰¾ç±»ï¼Œé»˜è®¤å®ç°æ˜¯ç©ºæ–¹æ³•ã€‚</li>
</ul>
<p>å®˜æ–¹ API æ–‡æ¡£ä¸­å†™åˆ°ï¼š</p>
<blockquote>
<p>Subclasses of <code>ClassLoader</code> are encouraged to override <code>findClass(String name)</code>, rather than this method.</p>
<p>å»ºè®® <code>ClassLoader</code>çš„å­ç±»é‡å†™ <code>findClass(String name)</code>æ–¹æ³•è€Œä¸æ˜¯<code>loadClass(String name, boolean resolve)</code> æ–¹æ³•ã€‚</p>
</blockquote>
<p>å¦‚æœæˆ‘ä»¬ä¸æƒ³æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹ï¼Œå°±é‡å†™ <code>ClassLoader</code> ç±»ä¸­çš„ <code>findClass()</code> æ–¹æ³•å³å¯ï¼Œæ— æ³•è¢«çˆ¶ç±»åŠ è½½å™¨åŠ è½½çš„ç±»æœ€ç»ˆä¼šé€šè¿‡è¿™ä¸ªæ–¹æ³•è¢«åŠ è½½ã€‚ä½†æ˜¯ï¼Œå¦‚æœæƒ³æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹åˆ™éœ€è¦é‡å†™ <code>loadClass()</code> æ–¹æ³•ã€‚</p>
<p>é€šè¿‡è‡ªå®šä¹‰ç±»åŠ è½½å™¨æˆ‘ä»¬å¯ä»¥æ»¡è¶³è‡ªå·±çš„ç‰¹æ®Šéœ€æ±‚ã€‚å°±æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ Java ç±»çš„å­—èŠ‚ç ï¼ˆ <code>.class</code> æ–‡ä»¶ï¼‰è¿›è¡ŒåŠ å¯†ï¼ŒåŠ è½½æ—¶å†åˆ©ç”¨è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨å¯¹å…¶è§£å¯†ã€‚</p>
<h3 id="åŒäº²å§”æ´¾æ¨¡å‹"><a href="#åŒäº²å§”æ´¾æ¨¡å‹" class="headerlink" title="åŒäº²å§”æ´¾æ¨¡å‹"></a>åŒäº²å§”æ´¾æ¨¡å‹</h3><h4 id="ä»‹ç»-1"><a href="#ä»‹ç»-1" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h4><p>å…‰å†…ç½®çš„ç±»åŠ è½½å™¨å°±æœ‰ä¸‰ç§ä¹‹å¤šï¼Œå½“æˆ‘ä»¬æƒ³è¦åŠ è½½ä¸€ä¸ªç±»çš„æ—¶å€™ï¼Œå…·ä½“æ˜¯å“ªä¸ªç±»åŠ è½½å™¨åŠ è½½å‘¢ï¼ŸåŒäº²å§”æ´¾æ¨¡å‹ä¼šç»™ä½ ç­”æ¡ˆã€‚</p>
<p>æ ¹æ®å®˜ç½‘çš„ä»‹ç»ï¼š</p>
<blockquote>
<p>The ClassLoader class uses a delegation model to search for classes and resources. Each instance of ClassLoader has an associated parent class loader. When requested to find a class or resource, a ClassLoader instance will delegate the search for the class or resource to its parent class loader before attempting to find the class or resource itself. The virtual machineâ€™s built-in class loader, called the â€œbootstrap class loaderâ€, does not itself have a parent but may serve as the parent of a ClassLoader instance.</p>
</blockquote>
<p>ç¿»è¯‘è¿‡æ¥å¤§æ¦‚çš„æ„æ€æ˜¯ï¼š</p>
<blockquote>
<p><code>ClassLoader</code> ç±»ä½¿ç”¨å§”æ‰˜æ¨¡å‹æ¥æœç´¢ç±»å’Œèµ„æºã€‚æ¯ä¸ª <code>ClassLoader</code> å®ä¾‹éƒ½æœ‰ä¸€ä¸ªç›¸å…³çš„çˆ¶ç±»åŠ è½½å™¨ã€‚éœ€è¦æŸ¥æ‰¾ç±»æˆ–èµ„æºæ—¶ï¼Œ<code>ClassLoader</code> å®ä¾‹ä¼šåœ¨è¯•å›¾äº²è‡ªæŸ¥æ‰¾ç±»æˆ–èµ„æºä¹‹å‰ï¼Œå°†æœç´¢ç±»æˆ–èµ„æºçš„ä»»åŠ¡å§”æ‰˜ç»™å…¶çˆ¶ç±»åŠ è½½å™¨ã€‚<br>è™šæ‹Ÿæœºä¸­è¢«ç§°ä¸º â€œ<code>bootstrap class loader</code>â€œçš„å†…ç½®ç±»åŠ è½½å™¨æœ¬èº«æ²¡æœ‰çˆ¶ç±»åŠ è½½å™¨ï¼Œä½†æ˜¯å¯ä»¥ä½œä¸º <code>ClassLoader</code> å®ä¾‹çš„çˆ¶ç±»åŠ è½½å™¨ã€‚</p>
</blockquote>
<p>ä»ä¸Šé¢çš„ä»‹ç»å¯ä»¥çœ‹å‡ºï¼š</p>
<ul>
<li><code>ClassLoader</code> ç±»ä½¿ç”¨å§”æ‰˜æ¨¡å‹æ¥æœç´¢ç±»å’Œèµ„æºã€‚</li>
<li>åŒäº²å§”æ´¾æ¨¡å‹è¦æ±‚é™¤äº†é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨å¤–ï¼Œå…¶ä½™çš„ç±»åŠ è½½å™¨éƒ½åº”æœ‰è‡ªå·±çš„çˆ¶ç±»åŠ è½½å™¨ã€‚</li>
<li><code>ClassLoader</code> å®ä¾‹ä¼šåœ¨è¯•å›¾äº²è‡ªæŸ¥æ‰¾ç±»æˆ–èµ„æºä¹‹å‰ï¼Œå°†æœç´¢ç±»æˆ–èµ„æºçš„ä»»åŠ¡å§”æ‰˜ç»™å…¶çˆ¶ç±»åŠ è½½å™¨ã€‚</li>
</ul>
<p>ä¸‹å›¾å±•ç¤ºçš„å„ç§ç±»åŠ è½½å™¨ä¹‹é—´çš„å±‚æ¬¡å…³ç³»è¢«ç§°ä¸ºç±»åŠ è½½å™¨çš„â€œ**åŒäº²å§”æ´¾æ¨¡å‹(Parents Delegation Model)**â€ã€‚</p>
<p><img src="https://image.seeyourface.cn/2024/01/0c2e2eb7811f32d0b10a98c93f34e390.png" srcset="/img/loading.gif" lazyload alt="ç±»åŠ è½½å™¨å±‚æ¬¡ç»“æ„"></p>
<p><strong>æ³¨æ„ âš ï¸</strong>ï¼šåŒäº²å§”æ´¾æ¨¡å‹å¹¶ä¸æ˜¯ä¸€ç§å¼ºåˆ¶æ€§çš„çº¦æŸï¼Œåªæ˜¯ JDK å®˜æ–¹æ¨èçš„ä¸€ç§æ–¹å¼ã€‚å¦‚æœæˆ‘ä»¬å› ä¸ºæŸäº›ç‰¹æ®Šéœ€æ±‚æƒ³è¦æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹ï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œåæ–‡ä¼šä»‹ç»å…·ä½“çš„æ–¹æ³•ã€‚</p>
<p>å¦å¤–ï¼Œç±»åŠ è½½å™¨ä¹‹é—´çš„çˆ¶å­å…³ç³»ä¸€èˆ¬ä¸æ˜¯ä»¥ç»§æ‰¿çš„å…³ç³»æ¥å®ç°çš„ï¼Œè€Œæ˜¯é€šå¸¸ä½¿ç”¨ç»„åˆå…³ç³»æ¥å¤ç”¨çˆ¶åŠ è½½å™¨çš„ä»£ç ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ClassLoader</span> &#123;<br>  ...<br>  <span class="hljs-comment">// ç»„åˆ</span><br>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ClassLoader parent;<br>  <span class="hljs-keyword">protected</span> <span class="hljs-title function_">ClassLoader</span><span class="hljs-params">(ClassLoader parent)</span> &#123;<br>       <span class="hljs-built_in">this</span>(checkCreateClassLoader(), parent);<br>  &#125;<br>  ...<br>&#125;<br></code></pre></td></tr></table></figure>



<h4 id="åŒäº²å§”æ´¾æ¨¡å‹çš„æ‰§è¡Œæµç¨‹"><a href="#åŒäº²å§”æ´¾æ¨¡å‹çš„æ‰§è¡Œæµç¨‹" class="headerlink" title="åŒäº²å§”æ´¾æ¨¡å‹çš„æ‰§è¡Œæµç¨‹"></a>åŒäº²å§”æ´¾æ¨¡å‹çš„æ‰§è¡Œæµç¨‹</h4><p>åŒäº²å§”æ´¾æ¨¡å‹çš„å®ç°ä»£ç éå¸¸ç®€å•ï¼Œé€»è¾‘éå¸¸æ¸…æ™°ï¼Œéƒ½é›†ä¸­åœ¨ <code>java.lang.ClassLoader</code> çš„ <code>loadClass()</code> ä¸­ï¼Œç›¸å…³ä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> Class&lt;?&gt; loadClass(String name, <span class="hljs-type">boolean</span> resolve)<br>    <span class="hljs-keyword">throws</span> ClassNotFoundException<br>&#123;<br>    <span class="hljs-keyword">synchronized</span> (getClassLoadingLock(name)) &#123;<br>        <span class="hljs-comment">//é¦–å…ˆï¼Œæ£€æŸ¥è¯¥ç±»æ˜¯å¦å·²ç»åŠ è½½è¿‡</span><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> findLoadedClass(name);<br>        <span class="hljs-keyword">if</span> (c == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-comment">//å¦‚æœ c ä¸º nullï¼Œåˆ™è¯´æ˜è¯¥ç±»æ²¡æœ‰è¢«åŠ è½½è¿‡</span><br>            <span class="hljs-type">long</span> <span class="hljs-variable">t0</span> <span class="hljs-operator">=</span> System.nanoTime();<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-keyword">if</span> (parent != <span class="hljs-literal">null</span>) &#123;<br>                    <span class="hljs-comment">//å½“çˆ¶ç±»çš„åŠ è½½å™¨ä¸ä¸ºç©ºï¼Œåˆ™é€šè¿‡çˆ¶ç±»çš„loadClassæ¥åŠ è½½è¯¥ç±»</span><br>                    c = parent.loadClass(name, <span class="hljs-literal">false</span>);<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-comment">//å½“çˆ¶ç±»çš„åŠ è½½å™¨ä¸ºç©ºï¼Œåˆ™è°ƒç”¨å¯åŠ¨ç±»åŠ è½½å™¨æ¥åŠ è½½è¯¥ç±»</span><br>                    c = findBootstrapClassOrNull(name);<br>                &#125;<br>            &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException e) &#123;<br>                <span class="hljs-comment">//éç©ºçˆ¶ç±»çš„ç±»åŠ è½½å™¨æ— æ³•æ‰¾åˆ°ç›¸åº”çš„ç±»ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸</span><br>            &#125;<br><br>            <span class="hljs-keyword">if</span> (c == <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-comment">//å½“çˆ¶ç±»åŠ è½½å™¨æ— æ³•åŠ è½½æ—¶ï¼Œåˆ™è°ƒç”¨findClassæ–¹æ³•æ¥åŠ è½½è¯¥ç±»</span><br>                <span class="hljs-comment">//ç”¨æˆ·å¯é€šè¿‡è¦†å†™è¯¥æ–¹æ³•ï¼Œæ¥è‡ªå®šä¹‰ç±»åŠ è½½å™¨</span><br>                <span class="hljs-type">long</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> System.nanoTime();<br>                c = findClass(name);<br><br>                <span class="hljs-comment">//ç”¨äºç»Ÿè®¡ç±»åŠ è½½å™¨ç›¸å…³çš„ä¿¡æ¯</span><br>                sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 - t0);<br>                sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1);<br>                sun.misc.PerfCounter.getFindClasses().increment();<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (resolve) &#123;<br>            <span class="hljs-comment">//å¯¹ç±»è¿›è¡Œlinkæ“ä½œ</span><br>            resolveClass(c);<br>        &#125;<br>        <span class="hljs-keyword">return</span> c;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>æ¯å½“ä¸€ä¸ªç±»åŠ è½½å™¨æ¥æ”¶åˆ°åŠ è½½è¯·æ±‚æ—¶ï¼Œå®ƒä¼šå…ˆå°†è¯·æ±‚è½¬å‘ç»™çˆ¶ç±»åŠ è½½å™¨ã€‚åœ¨çˆ¶ç±»åŠ è½½å™¨æ²¡æœ‰æ‰¾åˆ°æ‰€è¯·æ±‚çš„ç±»çš„æƒ…å†µä¸‹ï¼Œè¯¥ç±»åŠ è½½å™¨æ‰ä¼šå°è¯•å»åŠ è½½ã€‚</p>
<p>ç»“åˆæºç ï¼Œç®€å•æ€»ç»“ä¸€ä¸‹åŒäº²å§”æ´¾æ¨¡å‹çš„æ‰§è¡Œæµç¨‹ï¼š</p>
<ul>
<li>åœ¨ç±»åŠ è½½çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šé¦–å…ˆåˆ¤æ–­å½“å‰ç±»æ˜¯å¦è¢«åŠ è½½è¿‡ã€‚å·²ç»è¢«åŠ è½½çš„ç±»ä¼šç›´æ¥è¿”å›ï¼Œå¦åˆ™æ‰ä¼šå°è¯•åŠ è½½ï¼ˆæ¯ä¸ªçˆ¶ç±»åŠ è½½å™¨éƒ½ä¼šèµ°ä¸€éè¿™ä¸ªæµç¨‹ï¼‰ã€‚</li>
<li>ç±»åŠ è½½å™¨åœ¨è¿›è¡Œç±»åŠ è½½çš„æ—¶å€™ï¼Œå®ƒé¦–å…ˆä¸ä¼šè‡ªå·±å»å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªè¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨å»å®Œæˆï¼ˆè°ƒç”¨çˆ¶åŠ è½½å™¨ <code>loadClass()</code>æ–¹æ³•æ¥åŠ è½½ç±»ï¼‰ã€‚è¿™æ ·çš„è¯ï¼Œæ‰€æœ‰çš„è¯·æ±‚æœ€ç»ˆéƒ½ä¼šä¼ é€åˆ°é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ <code>BootstrapClassLoader</code> ä¸­ã€‚</li>
<li>åªæœ‰å½“çˆ¶åŠ è½½å™¨åé¦ˆè‡ªå·±æ— æ³•å®Œæˆè¿™ä¸ªåŠ è½½è¯·æ±‚ï¼ˆå®ƒçš„æœç´¢èŒƒå›´ä¸­æ²¡æœ‰æ‰¾åˆ°æ‰€éœ€çš„ç±»ï¼‰æ—¶ï¼Œå­åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªå·±å»åŠ è½½ï¼ˆè°ƒç”¨è‡ªå·±çš„ <code>findClass()</code> æ–¹æ³•æ¥åŠ è½½ç±»ï¼‰ã€‚</li>
<li>å¦‚æœå­ç±»åŠ è½½å™¨ä¹Ÿæ— æ³•åŠ è½½è¿™ä¸ªç±»ï¼Œé‚£ä¹ˆå®ƒä¼šæŠ›å‡ºä¸€ä¸ª <code>ClassNotFoundException</code> å¼‚å¸¸ã€‚</li>
</ul>
<p>ğŸŒˆ æ‹“å±•ï¼š</p>
<blockquote>
<p><strong>JVM åˆ¤å®šä¸¤ä¸ª Java ç±»æ˜¯å¦ç›¸åŒçš„å…·ä½“è§„åˆ™</strong>ï¼šJVM ä¸ä»…è¦çœ‹ç±»çš„å…¨åæ˜¯å¦ç›¸åŒï¼Œè¿˜è¦çœ‹åŠ è½½æ­¤ç±»çš„ç±»åŠ è½½å™¨æ˜¯å¦ä¸€æ ·ã€‚åªæœ‰ä¸¤è€…éƒ½ç›¸åŒçš„æƒ…å†µï¼Œæ‰è®¤ä¸ºä¸¤ä¸ªç±»æ˜¯ç›¸åŒçš„ã€‚å³ä½¿ä¸¤ä¸ªç±»æ¥æºäºåŒä¸€ä¸ª <code>Class</code> æ–‡ä»¶ï¼Œè¢«åŒä¸€ä¸ªè™šæ‹ŸæœºåŠ è½½ï¼Œåªè¦åŠ è½½å®ƒä»¬çš„ç±»åŠ è½½å™¨ä¸åŒï¼Œé‚£è¿™ä¸¤ä¸ªç±»å°±å¿…å®šä¸ç›¸åŒã€‚</p>
</blockquote>
<h4 id="æ‰“ç ´åŒäº²å§”æ´¾çš„æ–¹æ³•"><a href="#æ‰“ç ´åŒäº²å§”æ´¾çš„æ–¹æ³•" class="headerlink" title="æ‰“ç ´åŒäº²å§”æ´¾çš„æ–¹æ³•"></a>æ‰“ç ´åŒäº²å§”æ´¾çš„æ–¹æ³•</h4><p>è‡ªå®šä¹‰åŠ è½½å™¨çš„è¯ï¼Œéœ€è¦ç»§æ‰¿ <code>ClassLoader</code> ã€‚å¦‚æœæˆ‘ä»¬ä¸æƒ³æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹ï¼Œå°±é‡å†™ <code>ClassLoader</code> ç±»ä¸­çš„ <code>findClass()</code> æ–¹æ³•å³å¯ï¼Œæ— æ³•è¢«çˆ¶ç±»åŠ è½½å™¨åŠ è½½çš„ç±»æœ€ç»ˆä¼šé€šè¿‡è¿™ä¸ªæ–¹æ³•è¢«åŠ è½½ã€‚ä½†æ˜¯ï¼Œå¦‚æœæƒ³æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹åˆ™éœ€è¦é‡å†™ <code>loadClass()</code> æ–¹æ³•ã€‚</p>
<p>ä¸ºä»€ä¹ˆæ˜¯é‡å†™ <code>loadClass()</code> æ–¹æ³•æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹å‘¢ï¼ŸåŒäº²å§”æ´¾æ¨¡å‹çš„æ‰§è¡Œæµç¨‹å·²ç»è§£é‡Šäº†ï¼š</p>
<blockquote>
<p>ç±»åŠ è½½å™¨åœ¨è¿›è¡Œç±»åŠ è½½çš„æ—¶å€™ï¼Œå®ƒé¦–å…ˆä¸ä¼šè‡ªå·±å»å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªè¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨å»å®Œæˆï¼ˆè°ƒç”¨çˆ¶åŠ è½½å™¨ <code>loadClass()</code>æ–¹æ³•æ¥åŠ è½½ç±»ï¼‰ã€‚</p>
</blockquote>
<p>é‡å†™ <code>loadClass()</code>æ–¹æ³•ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥æ”¹å˜ä¼ ç»ŸåŒäº²å§”æ´¾æ¨¡å‹çš„æ‰§è¡Œæµç¨‹ã€‚ä¾‹å¦‚ï¼Œå­ç±»åŠ è½½å™¨å¯ä»¥åœ¨å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨ä¹‹å‰ï¼Œå…ˆè‡ªå·±å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œæˆ–è€…åœ¨çˆ¶ç±»åŠ è½½å™¨è¿”å›ä¹‹åï¼Œå†å°è¯•ä»å…¶ä»–åœ°æ–¹åŠ è½½è¿™ä¸ªç±»ã€‚å…·ä½“çš„è§„åˆ™ç”±æˆ‘ä»¬è‡ªå·±å®ç°ï¼Œæ ¹æ®é¡¹ç›®éœ€æ±‚å®šåˆ¶åŒ–ã€‚</p>
<p>æˆ‘ä»¬æ¯”è¾ƒç†Ÿæ‚‰çš„ Tomcat æœåŠ¡å™¨ä¸ºäº†èƒ½å¤Ÿä¼˜å…ˆåŠ è½½ Web åº”ç”¨ç›®å½•ä¸‹çš„ç±»ï¼Œç„¶åå†åŠ è½½å…¶ä»–ç›®å½•ä¸‹çš„ç±»ï¼Œå°±è‡ªå®šä¹‰äº†ç±»åŠ è½½å™¨ <code>WebAppClassLoader</code> æ¥æ‰“ç ´åŒäº²å§”æ‰˜æœºåˆ¶ã€‚è¿™ä¹Ÿæ˜¯ Tomcat ä¸‹ Web åº”ç”¨ä¹‹é—´çš„ç±»å®ç°éš”ç¦»çš„å…·ä½“åŸç†ã€‚</p>
<p><img src="https://image.seeyourface.cn/2024/01/6c83c58cc5b97edca3ef2db2abe6ae7b.png" srcset="/img/loading.gif" lazyload alt="tomcat-class-loader-parents-delegation-model"></p>
<p>Tomcat è¿™å››ä¸ªè‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨å¯¹åº”çš„ç›®å½•å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>CommonClassLoader</code>å¯¹åº”<code>&lt;Tomcat&gt;/common/*</code></li>
<li><code>CatalinaClassLoader</code>å¯¹åº”<code>&lt;Tomcat &gt;/server/*</code></li>
<li><code>SharedClassLoader</code>å¯¹åº” <code>&lt;Tomcat &gt;/shared/*</code></li>
<li><code>WebAppClassloader</code>å¯¹åº” <code>&lt;Tomcat &gt;/webapps/&lt;app&gt;/WEB-INF/*</code></li>
</ul>
<p>ä»å›¾ä¸­çš„å§”æ´¾å…³ç³»ä¸­å¯ä»¥çœ‹å‡ºï¼š</p>
<ul>
<li><code>CommonClassLoader</code>ä½œä¸º <code>CatalinaClassLoader</code> å’Œ <code>SharedClassLoader</code> çš„çˆ¶åŠ è½½å™¨ã€‚<code>CommonClassLoader</code> èƒ½åŠ è½½çš„ç±»éƒ½å¯ä»¥è¢« <code>CatalinaClassLoader</code> å’Œ <code>SharedClassLoader</code> ä½¿ç”¨ã€‚å› æ­¤ï¼Œ<code>CommonClassLoader</code> æ˜¯ä¸ºäº†å®ç°å…¬å…±ç±»åº“ï¼ˆå¯ä»¥è¢«æ‰€æœ‰ Web åº”ç”¨å’Œ Tomcat å†…éƒ¨ç»„ä»¶ä½¿ç”¨çš„ç±»åº“ï¼‰çš„å…±äº«å’Œéš”ç¦»ã€‚</li>
<li><code>CatalinaClassLoader</code> å’Œ <code>SharedClassLoader</code> èƒ½åŠ è½½çš„ç±»åˆ™ä¸å¯¹æ–¹ç›¸äº’éš”ç¦»ã€‚<code>CatalinaClassLoader</code> ç”¨äºåŠ è½½ Tomcat è‡ªèº«çš„ç±»ï¼Œä¸ºäº†éš”ç¦» Tomcat æœ¬èº«çš„ç±»å’Œ Web åº”ç”¨çš„ç±»ã€‚<code>SharedClassLoader</code> ä½œä¸º <code>WebAppClassLoader</code> çš„çˆ¶åŠ è½½å™¨ï¼Œä¸“é—¨æ¥åŠ è½½ Web åº”ç”¨ä¹‹é—´å…±äº«çš„ç±»æ¯”å¦‚ Springã€Mybatisã€‚</li>
<li>æ¯ä¸ª Web åº”ç”¨éƒ½ä¼šåˆ›å»ºä¸€ä¸ªå•ç‹¬çš„ <code>WebAppClassLoader</code>ï¼Œå¹¶åœ¨å¯åŠ¨ Web åº”ç”¨çš„çº¿ç¨‹é‡Œè®¾ç½®çº¿ç¨‹çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ä¸º <code>WebAppClassLoader</code>ã€‚å„ä¸ª <code>WebAppClassLoader</code> å®ä¾‹ä¹‹é—´ç›¸äº’éš”ç¦»ï¼Œè¿›è€Œå®ç° Web åº”ç”¨ä¹‹é—´çš„ç±»éš”ã€‚</li>
</ul>
<p>å•çº¯ä¾é è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ²¡åŠæ³•æ»¡è¶³æŸäº›åœºæ™¯çš„è¦æ±‚ï¼Œä¾‹å¦‚ï¼Œæœ‰äº›æƒ…å†µä¸‹ï¼Œé«˜å±‚çš„ç±»åŠ è½½å™¨éœ€è¦åŠ è½½ä½å±‚çš„åŠ è½½å™¨æ‰èƒ½åŠ è½½çš„ç±»ã€‚</p>
<p>æ¯”å¦‚ï¼ŒSPI ä¸­ï¼ŒSPI çš„æ¥å£ï¼ˆå¦‚ <code>java.sql.Driver</code>ï¼‰æ˜¯ç”± Java æ ¸å¿ƒåº“æä¾›çš„ï¼Œç”±<code>BootstrapClassLoader</code> åŠ è½½ã€‚è€Œ SPI çš„å®ç°ï¼ˆå¦‚<code>com.mysql.cj.jdbc.Driver</code>ï¼‰æ˜¯ç”±ç¬¬ä¸‰æ–¹ä¾›åº”å•†æä¾›çš„ï¼Œå®ƒä»¬æ˜¯ç”±åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨æˆ–è€…è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ¥åŠ è½½çš„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€ä¸ªç±»åŠå…¶ä¾èµ–ç±»ç”±åŒä¸€ä¸ªç±»åŠ è½½å™¨åŠ è½½ã€‚æ‰€ä»¥ï¼ŒåŠ è½½ SPI çš„æ¥å£çš„ç±»åŠ è½½å™¨ï¼ˆ<code>BootstrapClassLoader</code>ï¼‰ä¹Ÿä¼šç”¨æ¥åŠ è½½ SPI çš„å®ç°ã€‚æŒ‰ç…§åŒäº²å§”æ´¾æ¨¡å‹ï¼Œ<code>BootstrapClassLoader</code> æ˜¯æ— æ³•æ‰¾åˆ° SPI çš„å®ç°ç±»çš„ï¼Œå› ä¸ºå®ƒæ— æ³•å§”æ‰˜ç»™å­ç±»åŠ è½½å™¨å»å°è¯•åŠ è½½ã€‚</p>
<p>å†æ¯”å¦‚ï¼Œå‡è®¾æˆ‘ä»¬çš„é¡¹ç›®ä¸­æœ‰ Spring çš„ jar åŒ…ï¼Œç”±äºå…¶æ˜¯ Web åº”ç”¨ä¹‹é—´å…±äº«çš„ï¼Œå› æ­¤ä¼šç”± <code>SharedClassLoader</code> åŠ è½½ï¼ˆWeb æœåŠ¡å™¨æ˜¯ Tomcatï¼‰ã€‚æˆ‘ä»¬é¡¹ç›®ä¸­æœ‰ä¸€äº›ç”¨åˆ°äº† Spring çš„ä¸šåŠ¡ç±»ï¼Œæ¯”å¦‚å®ç°äº† Spring æä¾›çš„æ¥å£ã€ç”¨åˆ°äº† Spring æä¾›çš„æ³¨è§£ã€‚æ‰€ä»¥ï¼ŒåŠ è½½ Spring çš„ç±»åŠ è½½å™¨ï¼ˆä¹Ÿå°±æ˜¯ <code>SharedClassLoader</code>ï¼‰ä¹Ÿä¼šç”¨æ¥åŠ è½½è¿™äº›ä¸šåŠ¡ç±»ã€‚ä½†æ˜¯ä¸šåŠ¡ç±»åœ¨ Web åº”ç”¨ç›®å½•ä¸‹ï¼Œä¸åœ¨ <code>SharedClassLoader</code> çš„åŠ è½½è·¯å¾„ä¸‹ï¼Œæ‰€ä»¥ <code>SharedClassLoader</code> æ— æ³•æ‰¾åˆ°ä¸šåŠ¡ç±»ï¼Œä¹Ÿå°±æ— æ³•åŠ è½½å®ƒä»¬ã€‚</p>
<p>å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ è¿™ä¸ªæ—¶å€™å°±éœ€è¦ç”¨åˆ° <strong>çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ï¼ˆ<code>ThreadContextClassLoader</code>ï¼‰</strong> äº†ã€‚</p>
<p>æ‹¿ Spring è¿™ä¸ªä¾‹å­æ¥è¯´ï¼Œå½“ Spring éœ€è¦åŠ è½½ä¸šåŠ¡ç±»çš„æ—¶å€™ï¼Œå®ƒä¸æ˜¯ç”¨è‡ªå·±çš„ç±»åŠ è½½å™¨ï¼Œè€Œæ˜¯ç”¨å½“å‰çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ã€‚è¿˜è®°å¾—æˆ‘ä¸Šé¢è¯´çš„å—ï¼Ÿæ¯ä¸ª Web åº”ç”¨éƒ½ä¼šåˆ›å»ºä¸€ä¸ªå•ç‹¬çš„ <code>WebAppClassLoader</code>ï¼Œå¹¶åœ¨å¯åŠ¨ Web åº”ç”¨çš„çº¿ç¨‹é‡Œè®¾ç½®çº¿ç¨‹çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ä¸º <code>WebAppClassLoader</code>ã€‚è¿™æ ·å°±å¯ä»¥è®©é«˜å±‚çš„ç±»åŠ è½½å™¨ï¼ˆ<code>SharedClassLoader</code>ï¼‰å€ŸåŠ©å­ç±»åŠ è½½å™¨ï¼ˆ <code>WebAppClassLoader</code>ï¼‰æ¥åŠ è½½ä¸šåŠ¡ç±»ï¼Œç ´åäº† Java çš„ç±»åŠ è½½å§”æ‰˜æœºåˆ¶ï¼Œè®©åº”ç”¨é€†å‘ä½¿ç”¨ç±»åŠ è½½å™¨ã€‚</p>
<p>çº¿ç¨‹çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨çš„åŸç†æ˜¯å°†ä¸€ä¸ªç±»åŠ è½½å™¨ä¿å­˜åœ¨çº¿ç¨‹ç§æœ‰æ•°æ®é‡Œï¼Œè·Ÿçº¿ç¨‹ç»‘å®šï¼Œç„¶ååœ¨éœ€è¦çš„æ—¶å€™å–å‡ºæ¥ä½¿ç”¨ã€‚è¿™ä¸ªç±»åŠ è½½å™¨é€šå¸¸æ˜¯ç”±åº”ç”¨ç¨‹åºæˆ–è€…å®¹å™¨ï¼ˆå¦‚ Tomcatï¼‰è®¾ç½®çš„ã€‚</p>
<p><code>Java.lang.Thread</code> ä¸­çš„<code>getContextClassLoader()</code>å’Œ <code>setContextClassLoader(ClassLoader cl)</code>åˆ†åˆ«ç”¨æ¥è·å–å’Œè®¾ç½®çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ã€‚å¦‚æœæ²¡æœ‰é€šè¿‡<code>setContextClassLoader(ClassLoader cl)</code>è¿›è¡Œè®¾ç½®çš„è¯ï¼Œçº¿ç¨‹å°†ç»§æ‰¿å…¶çˆ¶çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ã€‚</p>
<p>Spring è·å–çº¿ç¨‹çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">cl = Thread.currentThread().getContextClassLoader();<br></code></pre></td></tr></table></figure>



<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span>æ·±å…¥åˆ†æ Java ClassLoader åŸç†ï¼š<a target="_blank" rel="noopener" href="https://blog.csdn.net/xyang81/article/details/7292380">https://blog.csdn.net/xyang81/article/details/7292380</a>
<a href="#fnref:1" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:2" class="footnote-text"><span>Java ç±»åŠ è½½å™¨(ClassLoader)ï¼š<a target="_blank" rel="noopener" href="http://gityuan.com/2016/01/24/java-classloader/">http://gityuan.com/2016/01/24/java-classloader/</a>
<a href="#fnref:2" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:3" class="footnote-text"><span>Class ClassLoader - Oracle å®˜æ–¹æ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/api/java/lang/ClassLoader.html">https://docs.oracle.com/javase/8/docs/api/java/lang/ClassLoader.html</a>
<a href="#fnref:3" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:4" class="footnote-text"><span><a target="_blank" rel="noopener" href="https://javaguide.cn/java/jvm/classloader.html">https://javaguide.cn/java/jvm/classloader.html</a>
<a href="#fnref:4" rev="footnote" class="footnote-backref"> â†©</a></span></span></li></ol></div></section>
                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/JVM/" class="category-chain-item">JVM</a>
  
  
    <span>></span>
    
  <a href="/categories/JVM/%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8/" class="category-chain-item">ç±»åŠ è½½å™¨</a>
  
  

  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/JVM/" class="print-no-link">#JVM</a>
      
        <a href="/tags/%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8/" class="print-no-link">#ç±»åŠ è½½å™¨</a>
      
        <a href="/tags/%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE/" class="print-no-link">#åŒäº²å§”æ´¾</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>JVMç±»åŠ è½½å™¨å’ŒåŒäº²å§”æ´¾æ¨¡å‹</div>
      <div>https://seeyourface.cn/2024/01/06/JVMç±»åŠ è½½å™¨å’ŒåŒäº²å§”æ´¾æ¨¡å‹/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>ä½œè€…</div>
          <div>Yang Lei</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>å‘å¸ƒäº</div>
          <div>2024å¹´1æœˆ6æ—¥</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>è®¸å¯åè®®</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - ç½²å">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2024/05/30/Ollama%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE%E4%B8%8E%E4%BD%BF%E7%94%A8/" title="Ollamaå®‰è£…é…ç½®ä¸ä½¿ç”¨">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Ollamaå®‰è£…é…ç½®ä¸ä½¿ç”¨</span>
                        <span class="visible-mobile">ä¸Šä¸€ç¯‡</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2024/01/05/%E8%AE%B0%E4%B8%80%E6%AC%A1Spring%20boot%E6%9C%AC%E5%9C%B0%E5%90%AF%E5%8A%A8%E6%8A%A5IllegalAccessError%E5%BC%82%E5%B8%B8%E5%8E%9F%E5%9B%A0/" title="è®°ä¸€æ¬¡Spring bootæœ¬åœ°å¯åŠ¨æŠ¥IllegalAccessErrorå¼‚å¸¸åŸå› ">
                        <span class="hidden-mobile">è®°ä¸€æ¬¡Spring bootæœ¬åœ°å¯åŠ¨æŠ¥IllegalAccessErrorå¼‚å¸¸åŸå› </span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>ç›®å½•</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ï¼Œå°†å®ƒä¿æŒåœ¨æœ€åº•éƒ¨ -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">åšå®¢åœ¨å…è®¸ JavaScript è¿è¡Œçš„ç¯å¢ƒä¸‹æµè§ˆæ•ˆæœæ›´ä½³</div>
  </noscript>
</body>
</html>
